name: CI

on:
  push:
    branches: [main, develop]
  pull_request:
    branches: [main, develop]
  workflow_dispatch:
  workflow_call:

jobs:
  backend:
    name: Backend CI
    uses: ./.github/workflows/backend.yml
    secrets: inherit

  functions:
    name: Functions CI
    uses: ./.github/workflows/functions.yml
    secrets: inherit

  frontend:
    name: Frontend CI
    uses: ./.github/workflows/frontend.yml
    secrets: inherit

  ml-service:
    name: ML Service CI
    uses: ./.github/workflows/ml-service.yml
    secrets: inherit

  integration-readiness:
    name: Integration Readiness Check
    runs-on: ubuntu-latest
    needs: [backend, functions, frontend, ml-service]

    steps:
      - name: Summary
        run: |
          echo "All CI checks passed!"
          echo ""
          echo "Backend build: OK"
          echo "Functions build: OK"
          echo "Frontend build: OK"
          echo "ML Service: OK"
          echo ""
          echo "Required GitHub Secrets for deployment:"
          echo "  AZURE_WEBAPP_PUBLISH_PROFILE          - az webapp deployment list-publishing-profiles"
          echo "  AZURE_FUNCTIONAPP_PUBLISH_PROFILE      - az functionapp deployment list-publishing-profiles"
          echo "  AZURE_STATIC_WEB_APPS_API_TOKEN_GENTLE_WATER_079EE5803 - Azure SWA token"
